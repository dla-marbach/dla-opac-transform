# Bei mehrbändigen Werken Personen VON von der Hauptaufnahme in alle Teile kopieren
- op: core/text-transform
  engineConfig:
    facets:
    - type: text
      columnName: parent_type_mv
      query: Teil mit abhängigem Titel
      mode: text
  columnName: personBy_id_mv
  expression: |
    grel:
    forNonBlank(
      forEachIndex(
        cells['parent_type_mv'].value.split('␟'),
        i,
        v,
        if(
          v == 'Teil mit abhängigem Titel',
          forNonBlank(
            cells['parent_id_mv'].value.split('␟')[i].cross('ak', 'id')[0].cells['personBy_id_mv'].value,
            x,
            x,
            null
          ),
          null
        )
      ).join('␟'),
      x,
      forNonBlank(
        value,
        v,
        v + '␟' + x,
        x
      ),
      null
    )
- op: core/text-transform
  engineConfig:
    facets:
    - type: text
      columnName: parent_type_mv
      query: Teil mit abhängigem Titel
      mode: text
  columnName: personBy_role_mv
  expression: |
    grel:
    forNonBlank(
      forEachIndex(
        cells['parent_type_mv'].value.split('␟'),
        i,
        v,
        if(
          v == 'Teil mit abhängigem Titel',
          forNonBlank(
            cells['parent_id_mv'].value.split('␟')[i].cross('ak', 'id')[0].cells['personBy_role_mv'].value,
            x,
            x,
            null
          ),
          null
        )
      ).join('␟'),
      x,
      forNonBlank(
        value,
        v,
        v + '␟' + x,
        x
      ),
      null
    )
- op: core/text-transform
  engineConfig:
    facets:
    - type: text
      columnName: parent_type_mv
      query: Teil mit abhängigem Titel
      mode: text
  columnName: personBy_creator_mv
  expression: |
    grel:
    forNonBlank(
      forEachIndex(
        cells['parent_type_mv'].value.split('␟'),
        i,
        v,
        if(
          v == 'Teil mit abhängigem Titel',
          forNonBlank(
            cells['parent_id_mv'].value.split('␟')[i].cross('ak', 'id')[0].cells['personBy_creator_mv'].value,
            x,
            x,
            null
          ),
          null
        )
      ).join('␟'),
      x,
      forNonBlank(
        value,
        v,
        v + '␟' + x,
        x
      ),
      null
    )